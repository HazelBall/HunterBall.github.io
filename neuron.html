<!doctype html>
<html>
	<head>
		<title>Lego Neural Network</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
	</head>
	<body>
		<h1>Lego Neural Network</h1>
		<p>This neural network can deturmine, with accuracy, the size of a lego brick. Using sigmoid neurons, it goes through the image to determine the exact size of the brick.</p>
		<input type = "text" style = "width: 100px" placeholder = "name" id = "name" />
		<input type="text" style="width:50px;" value="10" placeholder = "width" id="sizeW" />
		<input type = "text" style = "width: 50px" value = "6" placeholder = "height" id = "sizeH"/>
		<input type = "file" id = "file"><br>
		<p id="img"></p>
		<canvas width="50" height="6" id="canvas"></canvas>
		<script>
			var text = "";
			$(document).ready(function () {
        $('#file').change(function () {
          if (this.files.length > 0) {
            $.each(this.files, function (i, v) {
              var reader = new FileReader();
              reader.onload = function (e) {
                var img = new Image();
                img.src = e.target.result;
                img.onload = function () {
                  // CREATE A CANVAS ELEMENT AND ASSIGN THE IMAGES TO IT.
                  var canvas = document.createElement("canvas");
                  var value1 = $('#sizeW').val();
                  var value2 = $('#sizeH').val();
                  // RESIZE THE IMAGES ONE BY ONE.
                  img.width = img.width / (img.width / value1);
                  img.height = img.height / (img.height / value2);
                  var ctx = canvas.getContext("2d");
                  ctx.clearRect(0, 0, canvas.width, canvas.height);
                  canvas.width = img.width;
                  canvas.height = img.height;
                  ctx.drawImage(img, 0, 0, img.width, img.height);
                  var pixelColorY = [];
                  var pixelColor = [];
                  var test = "";
                  for(var i = 0; i < value1; i ++) {
                  	for(var j = 0; j < value2; j ++) {
                  		imgData = ctx.getImageData(j, i, 1, 1);
                  		color = (imgData.data[0] * 0.3) + (imgData.data[1] * 0.59) + (imgData.data[2] * 0.11);
                  		pixelColorY.push(color);
                  	}
                  	pixelColor.push(pixelColorY);
                  	pixelColorY = [];
                  }
                  var pX = 0;
                  var pY = 0;
                  var legoW = 0;
                  var legoH = 0;
                  var brokenW = false;
                  var brokenH = false;
                  for(i in pixelColor) {
                  	var pixY = pixelColor[i]
                  	for(j in pixY) {
                  		if(pixY[j] <= 150) {
                  			if(i == 0) {
                  				legoW += 1;
                  			}
                  			test += "(" + i + ", " + j + ": Stud: " + pixY[j] + "), ";
                  		} else {
                  			if(j == 0) {
                  				test += "(" + i + ", " + j + ": Not Brick), ";
                  				brokenH = true;
                  				break;
                  			}
                  			brokenW = true;
                  			test += "(" + i + ", " + j + ": No Stud: " + pixY[j] + "), ";
                  			break;
                  		}
                  	}
                  	if(brokenW == true) {
                  		brokenW == false;
                  	}
                  	if(brokenH == true) {
                 			break;
                 		}
                 		legoH += 1;
                 		test += "Currently " + legoH + " layers, ";
                  }
                  window.alert("The Lego Brick is " + legoW + " studs by " + legoH + "studs.");
                  $('#img').append(img);      // SHOW THE IMAGES OF THE BROWSER.
                  // AUTO DOWNLOAD THE IMAGES, ONCES RESIZED.
                  var a = document.createElement('a');
                  a.href = canvas.toDataURL("image/png");
                  a.download = 'Resized.jpg';
                  document.body.appendChild(a);
                  //a.click();
                }
              };
              reader.readAsDataURL(this);
            });
          }
        });
    	});
		</script>
	</body>
</html>
